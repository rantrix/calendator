const { getCalendarMonth, sliceToWeeks } = require('./index');
const expect = require('chai').expect;

describe('calendator', () => {
  const dateCreator = (y, m, d) => `${y - 2000}-${m}-${d}`;

  describe('.getCalendarMonth()', function () {
    it("throws an error when there is no year", () => {
      expect(() => getCalendarMonth('year')).to.throw();
    });

    it('throws an error when cpuMonth is not within valid range', () => {
      expect(() => getCalendarMonth(2019, 20)).to.throw();
    });

    it('uses a default dateCreator if one is not provided', () => {
      const expected = [null, null, null, null, null, null];
      for (let i = 1; i < 30; i++) {
        expected.push(new Date(2020, 1, i));
      }
      expect(getCalendarMonth(2020, 1)).to.deep.equal(expected);
    });

    it('returns calendar month for Feburary 2020 (leap year)', () => {
      expect(getCalendarMonth(2020, 1, { dateCreator })).to.deep.equal([
        null, null, null, null, null, null, '20-1-1',
        '20-1-2', '20-1-3', '20-1-4', '20-1-5', '20-1-6', '20-1-7', '20-1-8',
        '20-1-9', '20-1-10', '20-1-11', '20-1-12', '20-1-13', '20-1-14', '20-1-15',
        '20-1-16', '20-1-17', '20-1-18', '20-1-19', '20-1-20', '20-1-21', '20-1-22',
        '20-1-23', '20-1-24', '20-1-25', '20-1-26', '20-1-27', '20-1-28', '20-1-29'
      ]);
    });


    it('returns calendar month for December 2019', () => {
      expect(getCalendarMonth(2019, 11, { dateCreator })).to.deep.equal([
        '19-11-1', '19-11-2', '19-11-3', '19-11-4', '19-11-5', '19-11-6', '19-11-7',
        '19-11-8', '19-11-9', '19-11-10', '19-11-11', '19-11-12', '19-11-13', '19-11-14',
        '19-11-15', '19-11-16', '19-11-17', '19-11-18', '19-11-19', '19-11-20', '19-11-21',
        '19-11-22', '19-11-23', '19-11-24', '19-11-25', '19-11-26', '19-11-27', '19-11-28',
        '19-11-29', '19-11-30', '19-11-31', null, null, null, null
      ]);
    });

    it('returns calendar month for January 2020', () => {
      expect(getCalendarMonth(2020, 0, { dateCreator })).to.deep.equal([
        null, null, null, '20-0-1', '20-0-2', '20-0-3', '20-0-4',
        '20-0-5', '20-0-6', '20-0-7', '20-0-8', '20-0-9', '20-0-10', '20-0-11',
        '20-0-12', '20-0-13', '20-0-14', '20-0-15', '20-0-16', '20-0-17', '20-0-18',
        '20-0-19', '20-0-20', '20-0-21', '20-0-22', '20-0-23', '20-0-24', '20-0-25',
        '20-0-26', '20-0-27', '20-0-28', '20-0-29', '20-0-30', '20-0-31', null
      ]);
    });

    it('returns calendar month for Feburary 2020 (leap year)', () => {
      expect(getCalendarMonth(2020, 1, { dateCreator })).to.deep.equal([
        null, null, null, null, null, null, '20-1-1',
        '20-1-2', '20-1-3', '20-1-4', '20-1-5', '20-1-6', '20-1-7', '20-1-8',
        '20-1-9', '20-1-10', '20-1-11', '20-1-12', '20-1-13', '20-1-14', '20-1-15',
        '20-1-16', '20-1-17', '20-1-18', '20-1-19', '20-1-20', '20-1-21', '20-1-22',
        '20-1-23', '20-1-24', '20-1-25', '20-1-26', '20-1-27', '20-1-28', '20-1-29'
      ]);
    });

    it('returns calendar month for Feburary 2019 (normal year)', () => {
      expect(getCalendarMonth(2019, 1, { dateCreator })).to.deep.equal([
        null, null, null, null, null, '19-1-1',
        '19-1-2', '19-1-3', '19-1-4', '19-1-5', '19-1-6', '19-1-7', '19-1-8',
        '19-1-9', '19-1-10', '19-1-11', '19-1-12', '19-1-13', '19-1-14', '19-1-15',
        '19-1-16', '19-1-17', '19-1-18', '19-1-19', '19-1-20', '19-1-21', '19-1-22',
        '19-1-23', '19-1-24', '19-1-25', '19-1-26', '19-1-27', '19-1-28', null, null
      ]);
    });

    it('returns calendar month for March 2020', () => {
      expect(getCalendarMonth(2020, 2, { dateCreator })).to.deep.equal([
        '20-2-1', '20-2-2', '20-2-3', '20-2-4', '20-2-5', '20-2-6', '20-2-7',
        '20-2-8', '20-2-9', '20-2-10', '20-2-11', '20-2-12', '20-2-13', '20-2-14',
        '20-2-15', '20-2-16', '20-2-17', '20-2-18', '20-2-19', '20-2-20', '20-2-21',
        '20-2-22', '20-2-23', '20-2-24', '20-2-25', '20-2-26', '20-2-27', '20-2-28',
        '20-2-29', '20-2-30', '20-2-31', null, null, null, null
      ]);
    });

    it('returns calendar month for April 2020', () => {
      expect(getCalendarMonth(2020, 3, { dateCreator })).to.deep.equal([
        null, null, null, '20-3-1', '20-3-2', '20-3-3', '20-3-4',
        '20-3-5', '20-3-6', '20-3-7', '20-3-8', '20-3-9', '20-3-10', '20-3-11',
        '20-3-12', '20-3-13', '20-3-14', '20-3-15', '20-3-16', '20-3-17', '20-3-18',
        '20-3-19', '20-3-20', '20-3-21', '20-3-22', '20-3-23', '20-3-24', '20-3-25',
        '20-3-26', '20-3-27', '20-3-28', '20-3-29', '20-3-30', null, null
      ]);
    });

    it('returns calendar month for May 2020', () => {
      expect(getCalendarMonth(2020, 4, { dateCreator })).to.deep.equal([
        null, null, null, null, null, '20-4-1', '20-4-2',
        '20-4-3', '20-4-4', '20-4-5', '20-4-6', '20-4-7', '20-4-8', '20-4-9',
        '20-4-10', '20-4-11', '20-4-12', '20-4-13', '20-4-14', '20-4-15', '20-4-16',
        '20-4-17', '20-4-18', '20-4-19', '20-4-20', '20-4-21', '20-4-22', '20-4-23',
        '20-4-24', '20-4-25', '20-4-26', '20-4-27', '20-4-28', '20-4-29', '20-4-30',
        '20-4-31', null, null, null, null, null, null
      ]);
    });

    it('returns calendar month for June 2020', () => {
      expect(getCalendarMonth(2020, 5, { dateCreator })).to.deep.equal([
        null, '20-5-1', '20-5-2', '20-5-3', '20-5-4', '20-5-5', '20-5-6',
        '20-5-7', '20-5-8', '20-5-9', '20-5-10', '20-5-11', '20-5-12', '20-5-13',
        '20-5-14', '20-5-15', '20-5-16', '20-5-17', '20-5-18', '20-5-19', '20-5-20',
        '20-5-21', '20-5-22', '20-5-23', '20-5-24', '20-5-25', '20-5-26', '20-5-27',
        '20-5-28', '20-5-29', '20-5-30', null, null, null, null
      ]);
    });

    it('returns calendar month for July 2020', () => {
      expect(getCalendarMonth(2020, 6, { dateCreator })).to.deep.equal([
        null, null, null, '20-6-1', '20-6-2', '20-6-3', '20-6-4',
        '20-6-5', '20-6-6', '20-6-7', '20-6-8', '20-6-9', '20-6-10', '20-6-11',
        '20-6-12', '20-6-13', '20-6-14', '20-6-15', '20-6-16', '20-6-17', '20-6-18',
        '20-6-19', '20-6-20', '20-6-21', '20-6-22', '20-6-23', '20-6-24', '20-6-25',
        '20-6-26', '20-6-27', '20-6-28', '20-6-29', '20-6-30', '20-6-31', null
      ]);
    });

    it('returns calendar month for August 2020', () => {
      expect(getCalendarMonth(2020, 7, { dateCreator })).to.deep.equal([
        null, null, null, null, null, null, '20-7-1',
        '20-7-2', '20-7-3', '20-7-4', '20-7-5', '20-7-6', '20-7-7', '20-7-8',
        '20-7-9', '20-7-10', '20-7-11', '20-7-12', '20-7-13', '20-7-14', '20-7-15',
        '20-7-16', '20-7-17', '20-7-18', '20-7-19', '20-7-20', '20-7-21', '20-7-22',
        '20-7-23', '20-7-24', '20-7-25', '20-7-26', '20-7-27', '20-7-28', '20-7-29',
        '20-7-30', '20-7-31', null, null, null, null, null
      ]);
    });

    it('returns calendar month for September 2020', () => {
      expect(getCalendarMonth(2020, 8, { dateCreator })).to.deep.equal([
        null, null, '20-8-1', '20-8-2', '20-8-3', '20-8-4', '20-8-5',
        '20-8-6', '20-8-7', '20-8-8', '20-8-9', '20-8-10', '20-8-11', '20-8-12',
        '20-8-13', '20-8-14', '20-8-15', '20-8-16', '20-8-17', '20-8-18', '20-8-19',
        '20-8-20', '20-8-21', '20-8-22', '20-8-23', '20-8-24', '20-8-25', '20-8-26',
        '20-8-27', '20-8-28', '20-8-29', '20-8-30', null, null, null
      ]);
    });

    it('returns calendar month for October 2020', () => {
      expect(getCalendarMonth(2020, 9, { dateCreator })).to.deep.equal([
        null, null, null, null, '20-9-1', '20-9-2', '20-9-3',
        '20-9-4', '20-9-5', '20-9-6', '20-9-7', '20-9-8', '20-9-9', '20-9-10',
        '20-9-11', '20-9-12', '20-9-13', '20-9-14', '20-9-15', '20-9-16', '20-9-17',
        '20-9-18', '20-9-19', '20-9-20', '20-9-21', '20-9-22', '20-9-23', '20-9-24',
        '20-9-25', '20-9-26', '20-9-27', '20-9-28', '20-9-29', '20-9-30', '20-9-31'
      ]);
    });

    it('returns calendar month for November 2020', () => {
      expect(getCalendarMonth(2020, 10, { dateCreator })).to.deep.equal([
        '20-10-1', '20-10-2', '20-10-3', '20-10-4', '20-10-5', '20-10-6', '20-10-7',
        '20-10-8', '20-10-9', '20-10-10', '20-10-11', '20-10-12', '20-10-13', '20-10-14',
        '20-10-15', '20-10-16', '20-10-17', '20-10-18', '20-10-19', '20-10-20', '20-10-21',
        '20-10-22', '20-10-23', '20-10-24', '20-10-25', '20-10-26', '20-10-27', '20-10-28',
        '20-10-29', '20-10-30', null, null, null, null, null
      ]);
    });

    it('returns calendar month for December 2020', () => {
      expect(getCalendarMonth(2020, 11, { dateCreator })).to.deep.equal([
        null, null, '20-11-1', '20-11-2', '20-11-3', '20-11-4', '20-11-5',
        '20-11-6', '20-11-7', '20-11-8', '20-11-9', '20-11-10', '20-11-11', '20-11-12',
        '20-11-13', '20-11-14', '20-11-15', '20-11-16', '20-11-17', '20-11-18', '20-11-19',
        '20-11-20', '20-11-21', '20-11-22', '20-11-23', '20-11-24', '20-11-25', '20-11-26',
        '20-11-27', '20-11-28', '20-11-29', '20-11-30', '20-11-31', null, null
      ]);
    });

    it('fills previous month', () => {
      expect(getCalendarMonth(2020, 11, { dateCreator, fillPreviousMonth: true })).to.deep.equal([
        '20-10-29', '20-10-30', '20-11-1', '20-11-2', '20-11-3', '20-11-4', '20-11-5',
        '20-11-6', '20-11-7', '20-11-8', '20-11-9', '20-11-10', '20-11-11', '20-11-12',
        '20-11-13', '20-11-14', '20-11-15', '20-11-16', '20-11-17', '20-11-18', '20-11-19',
        '20-11-20', '20-11-21', '20-11-22', '20-11-23', '20-11-24', '20-11-25', '20-11-26',
        '20-11-27', '20-11-28', '20-11-29', '20-11-30', '20-11-31', null, null
      ]);
    });

    it('fills previous month using last year for December', () => {
      expect(getCalendarMonth(2020, 0, { dateCreator, fillPreviousMonth: true })).to.deep.equal([
        '19-11-29', '19-11-30', '19-11-31', '20-0-1', '20-0-2', '20-0-3', '20-0-4', '20-0-5',
        '20-0-6', '20-0-7', '20-0-8', '20-0-9', '20-0-10', '20-0-11', '20-0-12',
        '20-0-13', '20-0-14', '20-0-15', '20-0-16', '20-0-17', '20-0-18', '20-0-19',
        '20-0-20', '20-0-21', '20-0-22', '20-0-23', '20-0-24', '20-0-25', '20-0-26',
        '20-0-27', '20-0-28', '20-0-29', '20-0-30', '20-0-31', null
      ]);
    });

    it('fills next month', () => {
      expect(getCalendarMonth(2020, 3, { dateCreator, fillNextMonth: true })).to.deep.equal([
        null, null, null, '20-3-1', '20-3-2', '20-3-3', '20-3-4',
        '20-3-5', '20-3-6', '20-3-7', '20-3-8', '20-3-9', '20-3-10', '20-3-11',
        '20-3-12', '20-3-13', '20-3-14', '20-3-15', '20-3-16', '20-3-17', '20-3-18',
        '20-3-19', '20-3-20', '20-3-21', '20-3-22', '20-3-23', '20-3-24', '20-3-25',
        '20-3-26', '20-3-27', '20-3-28', '20-3-29', '20-3-30', '20-4-1', '20-4-2'
      ]);
    });

    it('fills next month using next year for December', () => {
      expect(getCalendarMonth(2020, 11, { dateCreator, fillNextMonth: true })).to.deep.equal([
        null, null, '20-11-1', '20-11-2', '20-11-3', '20-11-4', '20-11-5',
        '20-11-6', '20-11-7', '20-11-8', '20-11-9', '20-11-10', '20-11-11', '20-11-12',
        '20-11-13', '20-11-14', '20-11-15', '20-11-16', '20-11-17', '20-11-18', '20-11-19',
        '20-11-20', '20-11-21', '20-11-22', '20-11-23', '20-11-24', '20-11-25', '20-11-26',
        '20-11-27', '20-11-28', '20-11-29', '20-11-30', '20-11-31', '21-0-1', '21-0-2'
      ]);
    });

    it('shifts the week based on startDay', () => {
      expect(getCalendarMonth(2020, 1, { dateCreator, startDay: 0 })).to.deep.equal([
        null, null, null, null, null, null, '20-1-1',
        '20-1-2', '20-1-3', '20-1-4', '20-1-5', '20-1-6', '20-1-7', '20-1-8',
        '20-1-9', '20-1-10', '20-1-11', '20-1-12', '20-1-13', '20-1-14', '20-1-15',
        '20-1-16', '20-1-17', '20-1-18', '20-1-19', '20-1-20', '20-1-21', '20-1-22',
        '20-1-23', '20-1-24', '20-1-25', '20-1-26', '20-1-27', '20-1-28', '20-1-29'
      ]);

      expect(getCalendarMonth(2020, 1, { dateCreator, startDay: 1 })).to.deep.equal([
        null, null, null, null, null, '20-1-1',
        '20-1-2', '20-1-3', '20-1-4', '20-1-5', '20-1-6', '20-1-7', '20-1-8',
        '20-1-9', '20-1-10', '20-1-11', '20-1-12', '20-1-13', '20-1-14', '20-1-15',
        '20-1-16', '20-1-17', '20-1-18', '20-1-19', '20-1-20', '20-1-21', '20-1-22',
        '20-1-23', '20-1-24', '20-1-25', '20-1-26', '20-1-27', '20-1-28', '20-1-29',
        null
      ]);

      expect(getCalendarMonth(2020, 1, { dateCreator, startDay: 2 })).to.deep.equal([
        null, null, null, null, '20-1-1',
        '20-1-2', '20-1-3', '20-1-4', '20-1-5', '20-1-6', '20-1-7', '20-1-8',
        '20-1-9', '20-1-10', '20-1-11', '20-1-12', '20-1-13', '20-1-14', '20-1-15',
        '20-1-16', '20-1-17', '20-1-18', '20-1-19', '20-1-20', '20-1-21', '20-1-22',
        '20-1-23', '20-1-24', '20-1-25', '20-1-26', '20-1-27', '20-1-28', '20-1-29',
        null, null
      ]);

      expect(getCalendarMonth(2020, 1, { dateCreator, startDay: 3 })).to.deep.equal([
        null, null, null, '20-1-1',
        '20-1-2', '20-1-3', '20-1-4', '20-1-5', '20-1-6', '20-1-7', '20-1-8',
        '20-1-9', '20-1-10', '20-1-11', '20-1-12', '20-1-13', '20-1-14', '20-1-15',
        '20-1-16', '20-1-17', '20-1-18', '20-1-19', '20-1-20', '20-1-21', '20-1-22',
        '20-1-23', '20-1-24', '20-1-25', '20-1-26', '20-1-27', '20-1-28', '20-1-29',
        null, null, null
      ]);

      expect(getCalendarMonth(2020, 1, { dateCreator, startDay: 4 })).to.deep.equal([
        null, null, '20-1-1',
        '20-1-2', '20-1-3', '20-1-4', '20-1-5', '20-1-6', '20-1-7', '20-1-8',
        '20-1-9', '20-1-10', '20-1-11', '20-1-12', '20-1-13', '20-1-14', '20-1-15',
        '20-1-16', '20-1-17', '20-1-18', '20-1-19', '20-1-20', '20-1-21', '20-1-22',
        '20-1-23', '20-1-24', '20-1-25', '20-1-26', '20-1-27', '20-1-28', '20-1-29',
        null, null, null, null
      ]);

      expect(getCalendarMonth(2020, 1, { dateCreator, startDay: 5 })).to.deep.equal([
        null, '20-1-1',
        '20-1-2', '20-1-3', '20-1-4', '20-1-5', '20-1-6', '20-1-7', '20-1-8',
        '20-1-9', '20-1-10', '20-1-11', '20-1-12', '20-1-13', '20-1-14', '20-1-15',
        '20-1-16', '20-1-17', '20-1-18', '20-1-19', '20-1-20', '20-1-21', '20-1-22',
        '20-1-23', '20-1-24', '20-1-25', '20-1-26', '20-1-27', '20-1-28', '20-1-29',
        null, null, null, null, null
      ]);

      expect(getCalendarMonth(2020, 1, { dateCreator, startDay: 6 })).to.deep.equal([
        '20-1-1', '20-1-2', '20-1-3', '20-1-4', '20-1-5', '20-1-6', '20-1-7', '20-1-8',
        '20-1-9', '20-1-10', '20-1-11', '20-1-12', '20-1-13', '20-1-14', '20-1-15',
        '20-1-16', '20-1-17', '20-1-18', '20-1-19', '20-1-20', '20-1-21', '20-1-22',
        '20-1-23', '20-1-24', '20-1-25', '20-1-26', '20-1-27', '20-1-28', '20-1-29',
        null, null, null, null, null, null
      ]);

      expect(getCalendarMonth(2020, 1, { dateCreator, startDay: 7 })).to.deep.equal([
        null, null, null, null, null, null, '20-1-1',
        '20-1-2', '20-1-3', '20-1-4', '20-1-5', '20-1-6', '20-1-7', '20-1-8',
        '20-1-9', '20-1-10', '20-1-11', '20-1-12', '20-1-13', '20-1-14', '20-1-15',
        '20-1-16', '20-1-17', '20-1-18', '20-1-19', '20-1-20', '20-1-21', '20-1-22',
        '20-1-23', '20-1-24', '20-1-25', '20-1-26', '20-1-27', '20-1-28', '20-1-29'
      ]);
    });
  });

  describe('.sliceToWeeks()', () => {
    it('returns calendar month for August 2020', () => {
      const calendarMonth = getCalendarMonth(2020, 7, { dateCreator });
      expect(sliceToWeeks(calendarMonth)).to.deep.equal([
        [null, null, null, null, null, null, '20-7-1'],
        ['20-7-2', '20-7-3', '20-7-4', '20-7-5', '20-7-6', '20-7-7', '20-7-8'],
        ['20-7-9', '20-7-10', '20-7-11', '20-7-12', '20-7-13', '20-7-14', '20-7-15'],
        ['20-7-16', '20-7-17', '20-7-18', '20-7-19', '20-7-20', '20-7-21', '20-7-22'],
        ['20-7-23', '20-7-24', '20-7-25', '20-7-26', '20-7-27', '20-7-28', '20-7-29'],
        ['20-7-30', '20-7-31', null, null, null, null, null]
      ]);
    });
  });
});
